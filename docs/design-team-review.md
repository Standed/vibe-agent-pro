# Video Agent Pro 产品方案 v7.0

> **目的**：团队评审用完整方案  
> **日期**：2026-01-01  
> **版本**：v7.0

---

# 一、用户交互

## 1.1 首页

### 布局设计（参考 Seko 2.0）

```
┌────┬──────────────────────────────────────────────────────────────────┐
│    │                                                                  │
│ 🎬 │                    ┌────────────────────────────────┐            │
│ 📁 │                    │ ✨ 有什么新的故事灵感？         │            │
│ 🎨 │                    │                                │            │
│    │                    │ [剧本] [角色] [画风▼]          │            │
│ ── │                    │                      [开始创作] │            │
│    │                    └────────────────────────────────┘            │
│    │                                                                  │
│    │  灵感广场                                          [查看更多]    │
│ ── │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                    │
│ 👤 │  │ 模板1  │ │ 模板2  │ │ 模板3  │ │ 模板4  │                    │
│    │  └────────┘ └────────┘ └────────┘ └────────┘                    │
│    │                                                                  │
│    │  最近项目                                                        │
│    │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                    │
│    │  │ 封面   │ │ 封面   │ │ 封面   │ │ + 新建 │                    │
│    │  │ 项目名 │ │ 项目名 │ │ 项目名 │ │        │                    │
│    │  └────────┘ └────────┘ └────────┘ └────────┘                    │
│    │                                                                  │
└────┴──────────────────────────────────────────────────────────────────┘
 48px                          主区域
```

### 左侧图标栏

| 图标 | 功能 | 说明 |
|------|------|------|
| 🎬 | 首页 | 项目列表、灵感广场 |
| 📁 | 素材库 | 全局角色/场景/图片资源 |
| 🎨 | 草稿画布 | 独立草稿（不关联项目） |
| 👤 | 头像 | 个人中心、设置 |

### 灵感输入区

**可选项**：

| 选项 | 功能 | 说明 |
|------|------|------|
| [剧本] | 上传剧本或者分镜脚本 | 勾选后 会解析内容，创建项目，进入到策划页面 |
| [角色] | 是否预设角色 | 可选择已有角色或直接在聊天框@角色 |
| [画风▼] | 选择主流画风 | 带预览图的下拉选择 |

**画风选项（带预览图）**：

| 画风 | 预览 | 说明 |
|------|------|------|
| 真实写实 | [预览图] | 照片级真实感 |
| 赛博朋克 | [预览图] | 霓虹、科技感 |
| 日系动漫 | [预览图] | 动漫风格 |
| 国风水墨 | [预览图] | 中国传统风格 |
| 3D 卡通 | [预览图] | 皮克斯风格 |

### 创建项目流程

```
灵感输入 + 选项勾选
    ↓ 点击"开始创作"
创建项目 Tab（自动填充）
    ├─ 项目名称（AI 建议/用户也可自己编辑）
    ├─ 项目梗概（用户可编辑）
    ├─ 画风（锁定，不可更改）
    ├─ 比例（锁定，不可更改）
    └─ [确认创建]
    ↓
进入策划页
```

**锁定规则**：
- ✅ 项目梗概：可编辑
- ❌ 画风：确认后不可更改
- ❌ 比例：确认后不可更改

---

## 1.2 策划页

### 布局设计

```
┌──────────────────────────────────┬───────────────────────────────────┐
│ 左：资产与脚本区                 │ 右：Agent 对话区                  │
│ ─────────────────                │ ───────────────                   │
│                                  │                                   │
│ 📝 剧本/故事概要        [编辑]  │ AI Agent                          │
│ ┌──────────────────────────────┐ │ ──────────                        │
│ │ 剧本内容预览...              │ │                                   │
│ └──────────────────────────────┘ │ Agent: 你好！请描述你的创作灵感   │
│                                  │                                   │
│ 👤 角色 (2)             [添加]  │ 用户: 咖啡店爱情故事              │
│ ┌─────────────────────────────┐  │                                   │
│ │ 🧑 小明 [三视图|Sora参考]   │  │ Agent: 已创建角色：              │
│ │ 预览图 + 选择图片            │  │ - 小明 (程序员)                  │
│ └─────────────────────────────┘  │ - 小红 (咖啡师)                  │
│ ┌─────────────────────────────┐  │                                   │
│ │ 👩 小红 [三视图|Sora参考]   │  │ 需要生成角色形象吗？             │
│ │ 预览图 + 选择图片            │  │                                   │
│ └─────────────────────────────┘  │ ─────────────────────────────────  │
│                                  │                                   │
│ 🏠 场景 (3)             [添加]  │ 快捷操作：                        │
│ ├ ☕ 咖啡厅                      │ [生成角色] [生成分镜] [进入画布]  │
│ ├ 🌳 公园                        │                                   │
│ └ 🏠 公寓                        │ @角色 /命令  📎                   │
│                                  │ [输入消息...]            [发送]  │
│ 🎬 分镜脚本 (12)        [编辑]  │                                   │
│ └ 预计时长: 3:12                 │                                   │
│                                  │                                   │
│                      [进入画布]  │                                   │
│                                  │                                   │
└──────────────────────────────────┴───────────────────────────────────┘
```

### 角色 Tab 设计

```
┌─────────────────────────────────────────────────────────────────────┐
│ 角色名称: 小明                                                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  [三视图]  |  [Sora参考]                                            │
│  ─────────────────────────────────────────────────────────────────  │
│                                                                     │
│  [三视图 Tab]                                                       │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │ 三视图预览: （这里是一张横版大图）          │ │
│  │ ┌─────────┐ ┌─────────┐ ┌─────────┐                           │ │
│  │ │ 正面    │ │ 侧面    │ │ 背面    │                           │ │
│  │ │ [预览]  │ │ [预览]  │ │ [预览]  │                           │ │
│  │ │[选择图]│ │[选择图]│ │[选择图]│                               │ │
│  │ └─────────┘ └─────────┘ └─────────┘                           │ │
│  │                                                                │ │
│  │ 角色描述/性格  外貌特征（选填）这些是在外面统一                   │ │
│  │                                                              │ │
│  │                                                                │ │
│  │ [上传图片] [AI生成三视图/支持图生图] [更新IP角色]                 │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                     │
│  [Sora参考 Tab]  注意原来的那些逻辑，查询状态，刷新回传等等功能          │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │ 参考素材:                                                      │ │
│  │ ┌─────────┐ ┌─────────┐ ┌─────────┐                           │ │
│  │ │ +上传   │ │ +上传   │ │ +AI生成 │                           │ │
│  │ │  图片   │ │  视频   │ │  参考图 │                           │ │
│  │ └─────────┘ └─────────┘ └─────────┘                           │ │
│  │                                                                │ │
│  │ Sora Identity ID (可选):                                      │ │
│  │ ┌──────────────────────────────────────────────────────────┐  │ │
│  │ │ 粘贴 Sora 码...                                          │  │ │
│  │ └──────────────────────────────────────────────────────────┘  │ │
│  │                                                                │ │
│  │ 生成优先级: Sora码 > 视频 > 图片                              │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 剧集管理

**下一集创建逻辑**：

| 操作位置 | 说明 |
|----------|------|
| 策划页内 | ❌ 不在这里创建下一集 |
| 首页剧集入口 | ✅ 在剧集管理中创建下一集 |

**继承规则**：
- ✅ 继承：角色、画风、尺寸
- ❌ 不继承：剧本内容、分镜脚本
- ✅ 保持：剧集概要/大纲不可修改

---

## 1.3 画布页

### 顶部视图切换

```
┌─────────────────────────────────────────────────────────────────────┐
│ ← 返回 │ 项目名称 │ [🎬画布] [🎨草稿] [⏱️时间轴] │ [下载(下载放我们最右边)] [设置]   │
└─────────────────────────────────────────────────────────────────────┘
```

### 画布视图布局 

设置用我们已有的头像小球就可以了，里面等效于首页的头像点进去的相关内容

```
┌────┬─────────────────────────────────────────────┬───────────────────┐
│    │                                             │                   │
│ 📋 │  场景1: 咖啡厅                              │ [Agent] [Pro]     │
│ 🎬 │  ┌────────────────────────────────────────┐│                   │
│ 📁 │  │ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐   ││ AI Agent          │
│    │  │ │ 01 │ │ 02 │ │ 03 │ │ 04 │ │ 05 │   ││ ────────          │
│ ── │  │ │ 📷 │ │ 📷 │ │ ⏳ │ │ ⏳ │ │ ⏳ │   ││                   │
│ ⚙️ │  │ └────┘ └────┘ └────┘ └────┘ └────┘   ││ 对话记录...       │
│    │  └────────────────────────────────────────┘│                   │
│    │                                             │ 快捷操作：        │
│    │  场景2: 公园 (▶ 收起)                       │ [Gemini生成]      │
│    │  场景3: 公寓 (▶ 收起)                       │ [Grid 2x2]        │
│    │                                             │ [即梦生成]        │
│    │  ─────────────────────────────────────────  │ [Sora生成]        │
│    │                                             │                   │
│    │  分镜详情（点击分镜展开）                   │ @角色 /命令       │
│    │  ┌─────────────────────────────────────┐   │ [输入...]  [发送] │
│    │  │ Shot 03 | 女主抬头                  │   │                   │
│    │  │ [大图预览] 景别:特写 运镜:固定 2s  │   │                   │
│    │  │ [上传] [从草稿应用] [重生成]        │   │                   │
│    │  └─────────────────────────────────────┘   │                   │
│    │                                             │                   │
└────┴─────────────────────────────────────────────┴───────────────────┘
 48px              可伸缩                           320px
```

### 分镜详情设计
（这里主要是用我们已有的内容，增加一些上传图片，从草稿应用等方式）
```
┌─────────────────────────────────────────────────────────────────────┐
│ Shot 03 | 女主抬头                                        [× 关闭] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────────────┐  基本信息                                 │
│  │                      │  ────────                                 │
│  │      大图预览        │  描述: 女主听到声音抬起头                  │
│  │                      │  景别: 特写                               │
│  │                      │  运镜: 固定                               │
│  │                      │  时长: 2秒                                │
│  └──────────────────────┘  对白：                                   │
│                            旁白：                                   │
│  图片操作                                                           │
│  ────────                                                           │
│  [上传图片] [从草稿应用] [重新生成]                                 │
│                                                                     │
│  生成历史                                                           │
│  ────────                                                           │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                                   │
│  │ v1  │ │ v2● │ │ v3  │ │ v4  │  ← 点击切换版本                   │
│  └─────┘ └─────┘ └─────┘ └─────┘                                   │
│                                                                     │
│  [应用当前版本]                                                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 1.4 左侧侧边栏

### 设计风格

- **宽度**：48px 图标栏
- **风格**：iOS 26 液态玻璃质感
- **参考**：Tapnow 左侧导航

### 图标列表

| 图标 | 功能 | 点击效果 |
|------|------|----------|
| 📋 | 策划 | 展开资产面板（剧本/角色/场景） |
| 🎬 | 分镜 | 展开分镜列表 |
| 📁 | 资源 | 展开资源库 |
| ── | 分隔线 | - |
| ⚙️ | 设置 | 项目设置 |

### 展开面板
场景跟分镜应该是一起的，默认是我们叫做分镜的logo下，结合我们已有的侧边栏内容理解
```
┌────┬────────────────────────────────┐
│    │                                │
│ 📋●│ 策划面板 (200px)               │
│ 🎬 │ ┌────────────────────────────┐ │
│ 📁 │ │ 📝 剧本            [编辑] │ │
│    │ │ 👤 角色 (2)        [添加] │ │
│ ── │ │ 🏠 场景 (3)        [添加] │ │
│ ⚙️ │ │ 🎬 分镜 (12)       [编辑] │ │
│    │ └────────────────────────────┘ │
│    │                                │
└────┴────────────────────────────────┘
 48px         200px
```

---

## 1.5 右侧聊天框

### Agent 模式

**定位**：批量操作、全局任务

**快捷操作按钮**：
- [Gemini 生成所有分镜]
- [Grid 2x2 生成所有分镜]
- [Sora2 生成所有分镜视频]
- [即梦生成所有分镜]

**斜杠命令**： 范围默认是全局的分镜号比如[1,20]
```
/gemini [范围]       Gemini 直出生成
/grid [范围]         Grid 2x2 生成
/jimeng [范围]       即梦生成
/sora [范围]         Sora 视频生成
/storyboard          从剧本生成分镜脚本
/edit 场景1 景别=中景 批量修改
/help                显示帮助
```

### Pro 模式

**定位**：单镜头精调

**触发**：点击分镜 → 自动切换到 Pro 模式 （跟现有逻辑一样）

**命令**：（对话框里面的内容和逻辑不用改）
```
/regenerate          重新生成当前分镜
/slice [1-4]         选择 Grid 切片
/switch-model        切换生成模型
```

---

## 1.6 草稿视图

### 布局

```
┌────┬─────────────────────────────────────────────┬───────────────────┐
│    │ [🎬画布] [🎨草稿] [⏱️时间轴]              │                   │
├────┼─────────────────────────────────────────────┼───────────────────┤
│    │                                             │                   │
│ 📋 │  无限画布区域                               │ [Agent] [Pro]     │
│ 🎬 │                                             │                   │
│ 📁 │  ┌──────┐      ┌──────┐                    │ 对话区域          │
│    │  │prompt│ ──→ │render│                    │                   │
│ ── │  └──────┘      └──────┘                    │                   │
│ ⚙️ │        │                                    │                   │
│    │        ↓                                    │ 从草稿应用到分镜：│
│    │  ┌──────┐      ┌──────┐                    │ [选择目标分镜]    │
│    │  │render│ ──→ │slice │                    │                   │
│    │  └──────┘      └──────┘                    │                   │
│    │                                             │                   │
└────┴─────────────────────────────────────────────┴───────────────────┘
```

### 节点类型（这块到时候可能还需进一步设计）

| 类型 | 说明 |
|------|------|
| prompt | 文字提示节点 |
| render | 生成图片节点 |
| slice | Grid 切片节点 |
| asset_ref | 资产引用节点 |

### 草稿能力边界

| 能力 | 支持 |
|------|------|
| 文生图 | ✅ |
| 图迭代 | ✅ |
| 节点连接 | ✅ |
| 图片反推 | ✅ |
| 视频生成 | ❌（在时间轴） |

---

## 1.7 时间轴视图

### 布局

```
┌────┬─────────────────────────────────────────────┬───────────────────┐
│    │ [🎬画布] [🎨草稿] [⏱️时间轴]              │                   │
├────┼─────────────────────────────────────────────┼───────────────────┤
│    │                                             │                   │
│ 📋 │  ┌──────────────────────────────────────┐  │ [Agent] [Pro]     │
│ 🎬 │  │                                      │  │                   │
│ 📁 │  │           视频预览区域               │  │ 视频生成：        │
│    │  │                                      │  │ [Sora2 生成视频] │
│ ── │  └──────────────────────────────────────┘  │ [批量生成视频]   │
│ ⚙️ │                                             │                   │
│    │  ════════════════════════════════════════  │                   │
│    │  │ 01 │ 02 │ 03 │ 04 │ 05 │ 06 │ 07 │    │                   │
│    │  ════════════════════════════════════════  │                   │
│    │  时间线轨道                                 │                   │
│    │                                             │                   │
└────┴─────────────────────────────────────────────┴───────────────────┘
```

---

# 二、后端设计

## 2.1 数据结构

### 现有表

| 表 | 用途 |
|----|------|
| profiles | 用户 |
| projects | 项目 |
| series | 剧集 |
| scenes | 场景 |
| shots | 分镜 |
| characters | 角色 |
| chat_messages | 对话记录 |
| sora_tasks | Sora 异步任务 |

### 扩展字段

```sql
-- 分镜表增加上传图片字段
ALTER TABLE public.shots
  ADD COLUMN IF NOT EXISTS uploaded_images JSONB DEFAULT '[]'::jsonb;

-- 项目表增加草稿节点
-- 存在 projects.metadata.draftNodes
```

### 角色 metadata 扩展

```json
{
  "turnaroundMode": {
    "characterId": "jimeng_xxx",
    "turnaroundImages": ["url1", "url2", "url3"],
    "stylePrompt": "25岁程序员..."
  },
  "soraMode": {
    "identityId": "sora_identity_xxx",
    "referenceVideo": "url",
    "frontFullImage": "url"
  },
  "preferredMode": "turnaround" | "sora"
}
```

## 2.2 API 设计

### 生成相关

| 接口 | 功能 |
|------|------|
| POST /api/generate/gemini | Gemini 直出生成 |
| POST /api/generate/grid | Grid 2x2 生成 |
| POST /api/generate/jimeng | 即梦生成 |
| POST /api/generate/sora | Sora 视频生成 |
| POST /api/storyboard/generate | AI 生成分镜脚本 |

### 批量操作

| 接口 | 功能 |
|------|------|
| POST /api/shots/batch-update | 批量更新分镜 |
| POST /api/shots/batch-generate | 批量生成 |

---

# 三、运维部署

## 3.1 当前架构

| 环境 | 位置 | 状态 |
|------|------|------|
| 生产环境 | 海外（Vercel） | ✅ 运行中 |
| 数据库 | Supabase | ✅ 运行中 |
| 存储 | Cloudflare R2 | ✅ 运行中 |

## 3.2 国内部署计划

| 组件 | 国内方案 | 说明 |
|------|----------|------|
| 应用 | 阿里云/腾讯云 | 需要备案 |
| 数据库 | 阿里云 RDS PostgreSQL | 兼容 Supabase |
| 存储 | 阿里云 OSS | 替代 R2 |
| CDN | 阿里云 CDN | 加速静态资源 |

## 3.3 双环境同步

- 代码：同一仓库，不同分支
- 数据：独立，不同步
- 配置：环境变量区分

---

# 四、补充文档

## 4.1 Bug 记录

详见：[Video Agent Pro bug记录](./bug-records.md)

## 4.2 交接文档

详见：[视频 agent 核心内容](./handover.md)

## 4.3 开发历史草稿记录

详见：[视频 Agent 开发](./dev-history.md)

---

# 五、开发优先级

## Phase 1: P0 

| 任务 | 说明 |
|------|------|
| 首页改版 | Seko 2.0 风格 + 灵感输入 |
| 画布侧边栏优化 | 48px 图标栏 + 液态玻璃风格 |
| 分镜详情增强 | 上传图片 + 从草稿应用 |
| 斜杠命令封装 | /gemini /grid /jimeng /sora |
| 角色 Tab 设计 | 三视图 + Sora 参考 |

## Phase 2: P1 

| 任务 | 说明 |
|------|------|
| 草稿视图 | 无限画布 + 节点连接 |
| 画布拖拽到对话 | 图片拖到右侧面板 |
| 命令提示列表 | 输入 / 后弹出 |

## Phase 3: P2 (后续)

| 任务 | 说明 |
|------|------|
| 时间轴增强 | 多轨道编辑 |
| 国内部署 | 阿里云/腾讯云 |
| Pro 多 Track | 分支迭代 |
