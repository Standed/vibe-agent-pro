# Video Agent Pro 产品设计方案（最终整合版）

> **目的**：在不颠覆现有架构的前提下，优化三大板块体验  
> **来源**：Claude 分析 + GPT 方案 + PDF 竞品分析 + 现有代码  
> **日期**：2025-12-31

---

## 〇、核心设计原则

| 原则 | 说明 |
|------|------|
| **对话为核心** | 用户像写代码一样，通过对话完成大部分操作 |
| **长视频友好** | 结构化资产管理优先于自由玩法 |
| **学习成本低** | 5 分钟内完成第一个分镜生成 |
| **双模式分工** | Agent 批量 + Pro 精调，职责清晰 |
| **可扩展不复杂** | MVP 只做必要结构，能力模块化补齐 |

---

## 一、竞品分析与定位

### 1.1 竞品启发

| 产品 | 核心特点 | 可借鉴 |
|------|----------|--------|
| **MulanAI** | 模板工作流、提示词注入、Agent 任务总览 | 任务面板设计 |
| **OiiOii** | 可选模板、批量分镜修改、全局角色库 | 模板系统 |
| **Tapnow** | 无限画布、节点工作流、拖拽进对话框 | 拖拽交互 |
| **Seko 2.0** | 三视图切换、小巧导航、美术风格统一 | 侧边栏精简 |
| **Medeo** | 聊天驱动 + todolist、批量生成编辑 | Agent 批量能力 |
| **Flova** | 故事板 + 时间线 + 右侧AI助手 | 经典布局 |
| **纳米AI** | 分镜编辑进入独立无限画布 | 草稿模式概念 |
| **Aipai** | Agent/标准模式双轨 | 双模式分离 |

### 1.2 我们的差异化与风险

**优势**：
- 四级结构（Series → Project → Scene → Shot）适合长视频
- chat_messages 支持项目/场景/分镜三级对话
- 角色一致性设计接近专业制作流

**风险**（坦诚）：
- 结构化带来学习成本
- 画布是"可视化"，不是"自由创作核心"
- 优势需要 UI 强引导才能被感知

**结论**：必须把"长视频的结构化优势"可视化展现，才能成立。

---

## 二、核心链路

```
首页（灵感输入 / 项目管理）
  ↓ 新建项目
策划页（剧本/资产/分镜脚本 + Agent 对话）
  ↓ 确认进入画布
画布页（结构化分镜可视化 + Pro 精调）
  ↓
时间轴视图（暂不深挖，保留入口）
```

**关键决策**：
- 策划页独立页面（更清晰的创作心智）
- 进入画布需要确认（保证资产准备度）
- 时间轴保持入口但不深挖设计

---

## 三、页面布局设计

### 3.1 首页

**目标**：快速新建项目 → 进入策划页

```
┌──────────────────────────────────────────────────────────────────┐
│  Logo                                          [资源库] [设置]   │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│                 ┌──────────────────────────────────┐             │
│                 │  ✨ 输入你的创作灵感...          │             │
│                 │                        [开始创作]│             │
│                 └──────────────────────────────────┘             │
│                                                                  │
│  最近项目                                            [查看全部]  │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐             │
│  │ 封面    │  │ 封面    │  │ 封面    │  │ + 新建  │             │
│  │ 项目名  │  │ 项目名  │  │ 项目名  │  │         │             │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘             │
│                                                                  │
│  推荐模板（可选）                                                 │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐                          │
│  │故事短片 │  │AI漫剧   │  │一键拉片 │                          │
│  └─────────┘  └─────────┘  └─────────┘                          │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

**交互**：
- 输入灵感 → 点击"开始创作" → 新建项目tab页面，自动填充相关内容，主流画风可选（或者这个步骤是在策划页处理）→  进入**策划页**
- 点击已有项目 → 进入**画布页**
- 点击模板 → 预填充灵感/分镜脚本

---

### 3.2 策划页（独立页面）

```
┌──────────────────────────────────┬───────────────────────────────┐
│ 左：资产与脚本区                 │ 右：Agent 对话区              │
│ ─────────────────                │ ───────────────               │
│                                  │                               │
│ 📝 剧本编辑器                    │ 对话记录                      │
│ ┌──────────────────────────────┐ │ ┌─────────────────────────────┐
│ │ [展开] 查看/编辑剧本         │ │ │ Agent: 你好！描述创作灵感...│
│ └──────────────────────────────┘ │ │                             │
│                                  │ │ 用户: 咖啡店爱情故事        │
│ 👤 角色列表 (2)           [+]   │ │                             │
│ ├ 🧑 小明 (程序员)              │ │ Agent: 已创建角色和场景...   │
│ └ 👩 小红 (咖啡师)              │ └─────────────────────────────┘
│                                  │                               │
│ 🏠 场景列表 (3)           [+]   │ 批量命令建议                  │
│ ├ ☕ 咖啡厅                      │ ┌─────────────────────────────┐
│ ├ 🌳 公园                        │ │ [生成角色] [生成分镜] [...]│
│ └ 🏠 公寓                        │ └─────────────────────────────┘
│                                  │                               │
│ 🎬 分镜脚本 (12)          [编辑]│ @角色 /命令   📎附件          │
│ └ 预计时长: 3:12                 │ [输入...]              [发送] │
│                                  │                               │
│ ──────────────────────────────── │ ─────────────────────────────  │
│                                  │                               │
│ 进度: ✅剧本 ✅角色 ✅场景 ✅分镜│                               │
│ [进入画布] ✅                    │                               │
│                                  │                               │
└──────────────────────────────────┴───────────────────────────────┘
         360px                            剩余宽度
```

**现有代码复用**：
- 剧本编辑：`DirectorMode`
- 分镜脚本表格：`ShotTableEditor`
- AI 分镜生成：`useAIStoryboard` + `StoryboardService`

**进入画布确认逻辑**：（你是不是可以想想，有时候是一些抽象的片，不需要固定的角色或者资产）
- 必选：已有剧本或至少 1 个场景 + 1 个镜头
- 弹窗检查项：
  - [ ] 角色是否已创建
  - [ ] 分镜脚本是否已生成
  - [ ] 是否需要先生成角色形象

---

### 3.3 画布页（我希望结合tapnow那种美感ui，排版更美一些，左侧边栏是比较小巧的策划、分镜脚本、资源等等logo）

```
┌────┬─────────────────────────────────────────────┬───────────────┐
│    │                                             │               │
│ 📋 │  场景1: 咖啡厅                              │ [Agent] [Pro] │
│ 🎬 │  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐        │               │
│ 📁 │  │ 01 │ │ 02 │ │ 03 │ │ 04 │ │ 05 │        │  对话区域     │
│    │  │ 📷 │ │ 📷 │ │ ⏳ │ │ ⏳ │ │ ⏳ │        │               │
│ ─  │  └────┘ └────┘ └────┘ └────┘ └────┘        │  可拖入图片   │
│    │                                             │  作为参考     │
│    │  场景2: 公园 (▶ 收起)                       │               │
│    │  场景3: 公寓 (▶ 收起)                       │               │
│    │                                             │               │
│ ⚙️ │  ─────────────────────────────────────────  │               │
│    │                                             │               │
│    │  镜头详情 (点击分镜展开)                    │  @角色 /命令  │
│    │  ┌───────────────────────────────────────┐ │  [输入...]    │
│    │  │ Shot 03 | 女主抬头                    │ │               │
│    │  │ [大图]  景别:特写 运镜:固定 时长:2s   │ │               │
│    │  │ 历史: ○ ● ○    [应用] [重生成]       │ │               │
│    │  └───────────────────────────────────────┘ │               │
│    │                                             │               │
└────┴─────────────────────────────────────────────┴───────────────┘
 48px              可伸缩                           320px (可收起)
```

**重点交互优化**：

| 优化项 | 说明 | 实现方式 |
|--------|------|----------|
| **画布图拖拽到对话** | 选中图片拖到右侧作为参考 | `text/uri-list` + `application/x-shot-id` |
| **图片点击预览+应用** | 点击放大，明确"应用"按钮 | 保持现有 `ShotDetailPanel` |
| **分镜详情入口** | 保持侧边栏触发或者画布里面的编辑按钮 | 复用 `ShotEditor` |
| **拖拽落点提示** | 拖入时显示高亮区域 | ChatPanel 增加 drop zone 样式 |

---

## 四、Agent / Pro 双模式

### 4.1 职责划分

| 模式 | 定位 | 能力范围 |
|------|------|----------|
| **Agent** | 批量操作 | 创建资产、批量生成、全局修改 |
| **Pro** | 精细调控 | 单镜头迭代、参数微调、多Track（这一点后续再做） |

### 4.2 斜杠命令

**Agent 模式**：（我希望优先是把我这四个集成好，比如Gemini直出生成所有分镜、Gemini Grid 2x2生成所有分镜、Sora2生成所有分镜视频、使用即梦生成所有分镜、然后再是一些针对我们项目有意义的指令，你别靠主观臆想）
```
/generate-all      生成所有待生成分镜
/generate 场景1    生成指定场景
/style 赛博朋克    全局应用风格
/storyboard        从剧本生成分镜脚本
/auto-fix          自动修复一致性问题
```

**Pro 模式**：（你要想一些有用的指令，我们一些内容现在直接在聊天记录能有按钮点击了）
```
/redo              重新生成当前分镜
/apply             应用选中图片
/branch            创建新分支 (Track B)
/refine            局部优化
/video             生成视频
```

---

## 五、一致性双模式（资产级别区分）

### 5.1 三视图模式（即梦）

- **用途**：风格化、动漫、角色一致性
- **流程**：三视图 → 文生图 → 图生视频
- **入口**：角色面板 Tab（"三视图"）

### 5.2 Sora 参考模式

- **优先级**：Sora码 > 参考视频 > 正面全身图
- **用户无素材**：提供"生成参考图"按钮
- **入口**：角色面板 Tab（"Sora 参考"）

**交互要点**：
- 用户只需选择模式，具体优先级由系统处理
- Agent 对话可指令："用即梦生成" / "用 Sora 生成"

---

## 六、草稿模式（后续扩展）

### 6.1 为什么需要草稿模式

- 长视频画布镜头多，不适合全部无限画布
- 用户需要"灵感探索"空间

### 6.2 草稿模式定义

**概念**：独立于主画布，用于"连续创作 + 头脑风暴"

**特点**：
- NodeType / parentId / position（参考 test/copy-of-canvas，以及tapnow，mulan.pro）
- 纵向链条（不一定是纵向的吧） + 连接线
- 生成结果一键"应用到分镜"（想想怎么打通，是单独的草稿模式，还是在该项目能切换的模式，还是针对项目中分镜能进入的模式）

**定位**：草稿空间 = 灵感探索，主画布 = 结构化成果

---

## 七、侧边栏优化

### 7.1 现状

- 宽度 320px + 三 Tab（策划/分镜/资源）
- 信息密度偏高

### 7.2 优化方案（想像tapnow画布里面一样，左侧几个小logo，点开有对应的功能会不会好点）

| 优化项 | 现状 | 建议 |
|--------|------|------|
| 默认宽度 | 320px | 260px |
| 场景折叠 | 默认展开 | 默认收起，只展开当前场景 |
| 紧凑模式 | 无 | 增加开关：缩略图+简短文本 |
| 快速跳转 | 无 | 场景下拉或搜索 |
| 图标栏 | 无 | 增加 48px 图标栏 |

---

## 八、数据结构（基于现有 Schema）

### 8.1 现有结构

| 表 | 用途 |
|----|------|
| `projects` | 基础信息 + `metadata.script` |
| `scenes` | 场景 + `grid_history` |
| `shots` | 镜头 + `generation_history` / `grid_images` |
| `characters` | 角色 + `metadata.soraIdentity` |
| `chat_messages` | 三级对话记录 |

### 8.2 建议扩展

```sql
-- projects 增加独立 script 字段（可选）
ALTER TABLE public.projects 
  ADD COLUMN IF NOT EXISTS script JSONB DEFAULT '{}'::jsonb;

-- shots 增加血缘追溯
ALTER TABLE public.shots
  ADD COLUMN IF NOT EXISTS parent_image_id TEXT,
  ADD COLUMN IF NOT EXISTS reference_ids JSONB DEFAULT '[]'::jsonb;
```

### 8.3 characters.metadata 扩展

```json
{
  "turnaroundMode": {
    "characterId": "jimeng_xxx",
    "turnaroundImages": ["url1", "url2", "url3"],
    "stylePrompt": "25岁程序员..."
  },
  "soraMode": {
    "identityId": "sora_identity_xxx",
    "referenceVideo": "url",
    "frontFullImage": "url"
  },
  "preferredMode": "turnaround" | "sora"
}
```

---

## 九、开发优先级

### Phase 1: MVP 核心闭环（这里也不对， 应该是一些我们已有的快捷agent功能要封装成为skillls指令等方式）

| 任务 | 优先级 | 复用代码 |
|------|--------|----------|
| 策划页 UI | P0 | `DirectorMode` + `ShotTableEditor` |
| Agent 自动创建资产 | P0 | `useAIStoryboard` |
| 画布侧边栏优化 | P0 | `LeftSidebarNew` | （这里画布整体也要结合tapnow的样式优化美感设计等等）
| `/generate-all` 批量生成 | P0 | 现有 generate API |

### Phase 2: 体验优化

| 任务 | 优先级 |
|------|--------|
| Pro 模式多 Track UI | P1 |（这个暂时不急）
| 角色一致性双模式 | P1 |（目前已经有了吧）
| 画布拖拽到对话 | P1 |（这个要有）
| 血缘追溯字段 | P1 |（暂时不急）

### Phase 3: 能力扩展

| 任务 | 优先级 |
|------|--------|
| 一键拉片 `/analyze` | P2 |（后续拓展）
| 草稿模式 | P2 |（这个优先级是不是要提高，跟核心链路比较相关）
| 公共工作流接入 | P3 |

---

## 十、待确认问题

1. **策划页进入画布**：确认弹窗需要包含哪些检查项？（你看我前面的批注，不一定要检查对吗）
2. **画布拖拽到对话**：是否需要视觉落点提示？（整个聊天框和历史记录区域都能被拖入，拖入后是到聊天框上面一点的上传图片那块）
3. **草稿模式入口**：独立页面还是画布内切换？（我建议是优先做画布内切换或者是点击分镜之后才进入，你要想想两者之间的利弊）
4. **首页模板卡片**：是否作为新手引导必选项？（后续做出来了才需要）
5. **Agent 能力边界**：能理解"改成近景"这种修改指令吗？（要做到能够批量编辑分镜内的各种元素（增删改查）、以及批量指定分镜生成等等，也要支持场景级别的指令和项目级别的指令）
