# 草稿模式深度辩证分析

> **核心问题**：草稿模式如何定位，才不会让视图太多太乱？  
> **日期**：2026-01-01

---

## 一、现有视图结构分析

### 当前画布页的视图

| 视图 | 定位 | 数据关联 |
|------|------|----------|
| **画布模式** | 结构化分镜管理 | Scene → Shot |
| **时间轴模式** | 视频预览和剪辑 | Shot → Video |

### 加入草稿模式后

| 视图 | 定位 | 问题 |
|------|------|------|
| 画布模式 | 结构化分镜管理 | - |
| 时间轴模式 | 视频预览和剪辑 | - |
| **草稿模式** | 自由探索 | ❓ 和画布重叠？太多视图？ |

---

## 二、草稿模式的本质是什么？

### 用户关键洞察

> "分镜的很多操作记录过程都是在分镜下对应的pro聊天记录，那草稿模式到底算什么"

**分镜级有 Pro 聊天记录**：
- 单个分镜的生成历史
- 迭代过程和对话
- `chat_messages` 关联 `shotId`

**那草稿模式能是什么？**

| 定位 | 说明 | 问题 |
|------|------|------|
| 分镜级草稿 | 和 Pro 聊天重复 | ❌ 没必要 |
| **项目级草稿** | 项目的灵感探索空间 | ✅ 有意义 |
| 全局草稿 | 不关联项目的探索 | ⚠️ 和项目脱节 |

**结论**：草稿应该是**项目级**的，不是分镜级的。

---

## 三、解决视图太多的问题

### 方案对比

| 方案 | 描述 | 优点 | 缺点 |
|------|------|------|------|
| **A. 独立视图** | 画布/时间轴/草稿 三选一 | 清晰分离 | 视图太多 |
| **B. 侧边栏功能** | 草稿作为左侧侧边栏 Tab | 不增加视图 | 空间有限 |
| **C. 悬浮面板** | 草稿作为可拖拽悬浮面板 | 灵活 | 遮挡主画布 |
| **D. 抽屉面板** | 草稿从底部/右侧抽屉展开 | 不干扰主画布 | 需要额外交互 |

### 我的建议：**方案 B + D 结合**

草稿不作为独立视图，而是：

1. **侧边栏新增 Tab**：左侧图标栏增加 [🎨 草稿] 入口
2. **展开为右侧抽屉面板**：点击后从右侧展开草稿画布（替换对话面板）
3. **项目级关联**：草稿属于当前项目，不是分镜级

```
┌────┬─────────────────────────────┬───────────────────────────────┐
│    │                             │                               │
│ 📋 │  主画布区域                 │ [Agent] [Pro] [🎨草稿]        │
│ 🎬 │                             │                               │
│ 📁 │  场景 + 分镜缩略图          │  ← 右侧面板切换 →             │
│    │                             │                               │
│ ── │                             │ 对话区域 / 草稿区域           │
│ 🎨 │                             │                               │
│ ⚙️ │                             │                               │
│    │                             │                               │
└────┴─────────────────────────────┴───────────────────────────────┘
```

**切换逻辑**：
- 点击 [Agent] → 右侧显示 Agent 对话
- 点击 [Pro] → 右侧显示 Pro 对话（分镜级）
- 点击 [🎨草稿] → 右侧显示项目草稿画布

---

## 四、草稿与分镜的打通

### 用户需求

> "分镜详情里面要支持自己上传图片或者是在该项目草稿模式里面应用到当前分镜的功能"

### 打通路径

```
项目草稿
    │
    ├─ 自由探索生成多张图
    │
    └─ 点击某张图 → [应用到分镜]
                        │
                        ↓
                  选择目标分镜
                        │
                        ↓
              更新 shot.grid_images / primaryImageUrl
```

### 分镜详情增强

```
分镜详情面板
├─ 当前图片预览
├─ 生成历史
├─ [上传图片] ← 直接上传应用
├─ [从草稿应用] ← 打开草稿选择器
└─ [重新生成]
```

---

## 五、草稿数据结构设计

### 项目级草稿表（建议）

```sql
CREATE TABLE draft_nodes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id UUID REFERENCES projects(id) ON DELETE CASCADE,
  
  -- 节点类型
  node_type TEXT NOT NULL, -- 'prompt' | 'render' | 'asset_ref'
  
  -- 内容
  prompt TEXT,
  image_url TEXT,
  asset_ids JSONB DEFAULT '[]'::jsonb, -- 关联的角色/场景
  
  -- 布局
  position_x FLOAT DEFAULT 0,
  position_y FLOAT DEFAULT 0,
  
  -- 关系
  parent_id UUID REFERENCES draft_nodes(id) ON DELETE SET NULL,
  
  -- 元数据
  model TEXT, -- 'gemini' | 'jimeng' | 'sora'
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 不需要新增表的轻量方案

```typescript
// 存在 projects.metadata.draftNodes
interface DraftNode {
  id: string;
  nodeType: 'prompt' | 'render' | 'asset_ref';
  prompt?: string;
  imageUrl?: string;
  parentId?: string;
  position: { x: number; y: number };
  model?: 'gemini' | 'jimeng' | 'sora';
  createdAt: number;
}
```

---

## 六、和纳米AI对比

### 纳米AI 的做法

> "分镜编辑时进入独立的无限画布"

- 入口：点击分镜 → 进入该分镜的无限画布
- 范围：只关联当前分镜
- 结果：生成的图自动成为该分镜的候选图

### 我们的差异

| 维度 | 纳米AI | 我们建议 |
|------|--------|----------|
| 入口 | 分镜级 | 项目级（右侧面板） |
| 范围 | 单分镜 | 整个项目 |
| 结果 | 直接应用 | 手动选择应用到哪个分镜 |

**为什么项目级更好？**
- 一次探索可以产出多个分镜的参考
- 避免重复进入不同分镜的草稿
- 项目级资产可以复用到多个分镜

---

## 七、斜杠命令参考借鉴

### Midjourney Discord 指令

| 指令 | 功能 | 我们可借鉴 |
|------|------|------------|
| `/imagine` | 生成图片 | `/generate` |
| `/blend` | 混合多张图 | `/blend @角色1 @场景1` |
| `/describe` | 图片转描述 | `/analyze` |
| `--ar 16:9` | 宽高比参数 | `--ar 16:9` |
| `--style raw` | 风格参数 | `--style 赛博朋克` |

### Claude Code 指令

| 指令 | 功能 | 我们可借鉴 |
|------|------|------------|
| `@file` | 引用文件 | `@角色` `@场景` |
| `/clear` | 清空上下文 | `/clear` |
| `/help` | 显示帮助 | `/help` |

### 我们的斜杠命令最终设计

```
# 生成类
/gemini [范围]       Gemini 直出生成
/grid [范围]         Gemini Grid 2x2 生成
/jimeng [范围]       即梦生成
/sora [范围]         Sora 视频生成

# 范围参数
[范围] = all | 场景名 | 分镜编号

# 辅助类
/analyze [图片]      分析图片生成描述
/blend @资产...      混合多个资产生成
/status              查看当前生成状态
/help                显示帮助

# 批量编辑类
/edit 场景1 景别=中景   批量修改分镜属性
/add 场景1 after:3 n:2  在第3个分镜后插入2个
/delete 场景1 3-5      删除第3-5个分镜

# 样式参数（可选）
--ar 16:9            宽高比
--style 赛博朋克     风格
--no 文字            排除元素
```

---

## 八、最终结论

### 草稿模式定位

| 维度 | 结论 |
|------|------|
| **级别** | 项目级（不是分镜级） |
| **入口** | 画布右侧面板切换（不是独立视图） |
| **和 Pro 聊天的区别** | Pro = 分镜迭代历史；草稿 = 项目探索空间 |
| **与分镜打通** | 草稿图可"应用到分镜" |

### 视图结构（优化后）

```
画布主体
├─ 视图切换：画布 | 时间轴（只有2个）
│
├─ 左侧图标栏
│   ├─ 📋 策划
│   ├─ 🎬 分镜
│   ├─ 📁 资源
│   └─ ⚙️ 设置
│
└─ 右侧面板切换
    ├─ [Agent] Agent 对话
    ├─ [Pro] Pro 对话（分镜级）
    └─ [🎨] 项目草稿画布 ← 新增
```

**不增加新的视图层级**，只是右侧面板多了一个 Tab。
