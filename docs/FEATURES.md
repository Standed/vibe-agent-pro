# Video Agent Pro - 功能实现清单

## 🎯 核心功能状态

### ✅ 已完成功能 (v0.5.0)

#### 1. 云端持久化与同步 (Supabase)
- **PostgreSQL 存储**：所有项目、场景、镜头数据实时同步至云端。
- **三级聊天历史**：支持项目、场景、镜头三级 scope 的 AI 对话存储。
- **自动同步**：本地修改触发 800ms 防抖自动保存至云端。
- **离线回退**：网络不可用时自动回退至 IndexedDB (Dexie.js)。

#### 2. 安全与权限系统 (Whitelist & Auth)
- **Supabase Auth**：集成邮箱/密码登录与会话管理。
- **内测白名单**：`is_whitelisted` 拦截机制，仅限授权用户调用 AI 接口。
- **管理员双重验证**：结合数据库角色与硬编码管理员列表 (`src/config/users.ts`)。
- **频率限制**：防止 API 接口被恶意刷取。

#### 3. 积分计费系统 (Credits System)
- **差异化定价**：管理员免费，VIP 8 折，普通用户原价。
- **原子化扣费**：数据库 RPC 函数确保积分扣除的准确性与并发安全。
- **初始赠送**：注册自动根据角色分配初始积分 (User 60 / VIP 500 / Admin 1000)。
- **交易记录**：完整的积分消耗历史追踪。

#### 4. 管理员后台 (/admin)
- **学员管理**：一键开通/关闭白名单、手动充值积分、禁用账号。
- **反馈监控**：查看用户提交的带上下文（项目、镜头、浏览器信息）的 Bug 报告。
- **全站概览**：统计总用户数、总积分消耗、活跃度等。

#### 5. 画布系统 (InfiniteCanvas)
- **缩放功能**：50%-200% 缩放，实时显示百分比。
- **平移功能**：鼠标拖拽画布（cursor-grab）。
- **浮动工具栏**：ZoomIn/ZoomOut 按钮，点击百分比重置。
- **场景卡片展示**：Grid 布局展示所有场景和镜头。
- **镜头状态指示**：done/processing/error 状态颜色标识。
- **点状网格背景**：完全匹配专业影视软件审美。

#### 6. Grid 多视图生成 (Gemini 2.0 Flash)
- **2x2 / 3x3 Grid**：支持 4视图 和 9视图 生成。
- **画面比例选择**：16:9、4:3、21:9、1:1、3:4、9:16。
- **参考图片支持**：支持上传多张参考图保持视觉一致性。
- **风格预设**：电影级、动画、写实、赛博朋克。
- **切片预览与分配**：`GridPreviewModal` 支持手动将切片分配给特定镜头。

#### 7. 视频生成 (Volcano Engine SeeDance)
- **图生视频**：基于分镜参考图生成 4-6 秒高清视频。
- **异步任务处理**：支持任务进度轮询与状态实时更新。
- **请求取消**：支持随时中止正在进行的生成任务。

#### 8. AI Agent 对话系统 (useAgent)
- **工具调用 (Function Calling)**：Agent 可自动执行创建场景、添加分镜、生成图片等操作。
- **上下文增强**：自动注入当前项目、场景、镜头的详细元数据。
- **思考过程追踪**：实时展示 AI 的推理步骤与执行进度。
- **防重复提交**：基于消息哈希的拦截逻辑，提升稳定性。

#### 9. UI/UX 深度优化
- **分镜详情面板**：参考 oiioii 风格，支持大图预览、版本历史、精细参数编辑。
- **新版左侧栏**：剧本、分镜脚本、资源管理三位一体。
- **Cinema Dark 主题**：深邃的紫色调专业影视创作界面。

### ⚙️ 技术栈 (v0.5.0)

- **框架**：Next.js 15.5.6 (App Router + Turbopack)
- **前端**：React 19, TypeScript 5.8.2
- **状态管理**：Zustand + Immer
- **后端/数据库**：Supabase (PostgreSQL + Auth)
- **文件存储**：Cloudflare R2 (通过 API 代理)
- **AI 模型**：
  - Google Gemini 2.0 Flash (Grid & Text)
  - 火山引擎 SeeDream 4.5 (Image)
  - 火山引擎 SeeDance 1.0 Pro (Video)
  - 火山引擎 Doubao Pro (Agent Chat)

### 📋 待完成功能

#### 高优先级
1. **Grid 生成历史记录**：每个场景支持查看和回滚之前的 Grid 版本。
2. **Timeline 实际播放**：实现视频片段与音频轨道的同步预览。
3. **视频导出**：一键合成所有分镜并导出为 MP4。
4. **TTS 语音合成**：为分镜旁白自动生成配音。

#### 中优先级
5. **场景拖拽重排**：在画布上自由调整场景卡片位置并持久化。
6. **Timeline 剪辑功能**：支持拖拽调整 Clip 的入点、出点和时长。
7. **项目分享**：生成只读分享链接或导出项目包。

---

**最后更新**: 2025-12-18
**版本**: v0.5.0
