# Video Agent Pro UI 优化执行计划

> **版本**：v6.0 (视图结构优化)  
> **日期**：2026-01-01  
> **状态**：待确认

---

## 一、核心设计决策

| 决策项 | 结论 |
|--------|------|
| **进入画布** | ❌ 无需确认弹窗 |
| **首页风格** | Seko 2.0 左侧 48px 图标栏 |
| **视图切换** | 顶部图标栏：画布 / 草稿 / 时间轴 |
| **右侧面板** | 始终是 Agent/Pro 对话（不放草稿） |
| **草稿能力** | 只处理图片（文生图、图迭代） |
| **视频处理** | 只在时间轴视图 |

---

## 二、视图结构重新设计

### 2.1 顶部视图切换（参考截图红框位置）

```
┌─────────────────────────────────────────────────────────────────────┐
│ ← 返回首页 │ 项目名称 │ [🎬画布] [🎨草稿] [⏱️时间轴] │ 其他按钮...  │
└─────────────────────────────────────────────────────────────────────┘
                          ↑ 顶部视图切换区域
```

### 2.2 三个视图的定位

| 视图 | 定位 | 处理内容 |
|------|------|----------|
| **🎬 画布** | 结构化分镜管理 | 场景/分镜的图片生成 |
| **🎨 草稿** | 自由探索（无限画布） | 文生图、图片迭代、节点连接 |
| **⏱️ 时间轴** | 视频预览和剪辑 | 视频生成、时间线编辑 |

### 2.3 右侧面板（所有视图共用）

```
右侧面板
├─ [Agent] Agent 模式（批量操作）
└─ [Pro] Pro 模式（精细调控）

不再包含草稿 Tab！
```

---

## 三、页面布局

### 3.1 首页（Seko 2.0 风格）

```
┌────┬──────────────────────────────────────────────────────────────┐
│    │                                                              │
│ 🏠 │                  ┌────────────────────────────┐              │
│ 📁 │                  │ ✨ 有什么新的故事灵感？     │              │
│ 🎨 │                  │ [剧本][角色][画风] [开始创作]│              │
│    │                  └────────────────────────────┘              │
│ ── │                                                              │
│ ⚙️ │  灵感广场 / 最近项目                                         │
│    │                                                              │
└────┴──────────────────────────────────────────────────────────────┘
```

**首页输入选项（可选）**：
- [剧本] - 是否需要 AI 生成剧本
- [角色] - 是否预设角色
- [画风] - 选择主流画风

### 3.2 画布视图

```
┌────┬──────────────────────────────────────────────────────────────┐
│    │ [🎬画布] [🎨草稿] [⏱️时间轴]                      顶部切换    │
├────┼─────────────────────────────────────┬────────────────────────┤
│    │                                     │                        │
│ 📋 │  场景1: 咖啡厅                      │ [Agent] [Pro]          │
│ 🎬 │  ┌────┐ ┌────┐ ┌────┐ ┌────┐       │                        │
│ 📁 │  │ 01 │ │ 02 │ │ 03 │ │ 04 │       │  对话区域              │
│    │  └────┘ └────┘ └────┘ └────┘       │                        │
│ ── │                                     │  快捷操作：            │
│ ⚙️ │  场景2: 公园 (收起)                  │  [Gemini Grid 生成]   │
│    │                                     │  [Sora2 生成]          │
│    │  分镜详情区域                        │  [即梦生成]            │
│    │                                     │                        │
└────┴─────────────────────────────────────┴────────────────────────┘
```

### 3.3 草稿视图（无限画布）

```
┌────┬──────────────────────────────────────────────────────────────┐
│    │ [🎬画布] [🎨草稿] [⏱️时间轴]                      顶部切换    │
├────┼─────────────────────────────────────┬────────────────────────┤
│    │                                     │                        │
│ 📋 │  ┌─────┐      ┌─────┐              │ [Agent] [Pro]          │
│ 🎬 │  │prompt│ ──→ │render│             │                        │
│ 📁 │  └─────┘      └─────┘              │  对话区域              │
│    │       │                             │                        │
│ ── │       ↓                             │  从草稿应用到分镜：    │
│ ⚙️ │  ┌─────┐      ┌─────┐              │  [选择目标分镜]        │
│    │  │render│ ──→ │slice│              │                        │
│    │  └─────┘      └─────┘              │                        │
│    │                                     │                        │
└────┴─────────────────────────────────────┴────────────────────────┘
```

**草稿视图特点**：
- 只处理**图片**（文生图、图迭代）
- 不处理视频
- 支持节点连接（参考 Tapnow/test/copy-of-canvas）
- 结果可"应用到分镜"

### 3.4 时间轴视图

```
┌────┬──────────────────────────────────────────────────────────────┐
│    │ [🎬画布] [🎨草稿] [⏱️时间轴]                      顶部切换    │
├────┼─────────────────────────────────────┬────────────────────────┤
│    │                                     │                        │
│ 📋 │  ┌──────────────────────────────┐  │ [Agent] [Pro]          │
│ 🎬 │  │         视频预览              │  │                        │
│ 📁 │  └──────────────────────────────┘  │  对话区域              │
│    │                                     │                        │
│ ── │  ════════════════════════════════  │  视频生成：            │
│ ⚙️ │  │ 01 │ 02 │ 03 │ 04 │ 05 │ 06 │  │  [Sora2 生成视频]      │
│    │  ════════════════════════════════  │  [批量生成视频]        │
│    │  时间线轨道                         │                        │
│    │                                     │                        │
└────┴─────────────────────────────────────┴────────────────────────┘
```

**时间轴视图特点**：
- 处理**视频**（Sora 生成、视频剪辑）
- 多轨道时间线
- 视频预览和导出

---

## 四、三个视图的能力边界

| 能力 | 画布 | 草稿 | 时间轴 |
|------|------|------|--------|
| **结构管理** | ✅ 场景/分镜 | ❌ 自由 | ❌ 时间线 |
| **文生图** | ✅ | ✅ | ❌ |
| **图迭代** | ✅ | ✅ | ❌ |
| **节点连接** | ❌ | ✅ | ❌ |
| **视频生成** | ❌ | ❌ | ✅ |
| **视频剪辑** | ❌ | ❌ | ✅ |

---

## 五、草稿视图详细设计

### 5.1 节点类型（参考 test/copy-of-canvas）

```typescript
type NodeType = 'prompt' | 'asset_group' | 'render' | 'slice';

interface DraftNode {
  id: string;
  nodeType: NodeType;
  
  // 内容
  prompt?: string;           // prompt 节点
  imageUrl?: string;         // render 节点
  slices?: string[];         // slice 节点
  assetIds?: string[];       // asset_group 节点
  
  // 关系
  parentId?: string;         // 父节点（连接线）
  
  // 布局
  position: { x: number; y: number };
  
  // 元数据
  model?: 'gemini' | 'jimeng'; // 不包含 sora
  createdAt: number;
}
```

### 5.2 与分镜打通

```
草稿节点 [render]
    ↓ 点击"应用到分镜"
弹出分镜选择器
    ↓ 选择 场景 → 分镜
更新 shot.grid_images 或 shot.primaryImageUrl
```

### 5.3 分镜详情增强

```
分镜详情面板
├─ 当前图片预览
├─ 生成历史
├─ [上传图片] ← 直接上传
├─ [从草稿应用] ← 打开草稿选择器
└─ [重新生成]
```

---

## 六、斜杠命令设计

### 6.1 Agent 模式命令

```
# 批量生成
/gemini [范围]       Gemini 直出生成所有分镜
/grid [范围]         Gemini Grid 2x2 生成所有分镜
/jimeng [范围]       即梦生成所有分镜
/sora [范围]         Sora 视频生成所有分镜

# 范围参数
[范围] = all | 场景名 | 分镜编号

# 辅助
/storyboard          从剧本生成分镜脚本
/status              查看当前生成状态
/help                显示帮助

# 批量编辑
/edit 场景1 景别=中景
/add 场景1 after:3 n:2
/delete 场景1 3-5
```

### 6.2 Pro 模式命令

```
/regenerate          重新生成当前分镜
/slice [1-4]         选择 Grid 切片
/switch-model        切换生成模型
```

### 6.3 命令提示（输入 / 后弹出列表）

```
┌────────────────────────────────┐
│ /gemini    Gemini 直出生成     │
│ /grid      Grid 2x2 生成       │
│ /jimeng    即梦生成            │
│ /sora      Sora 视频生成       │
│ /storyboard 生成分镜脚本       │
│ ...                            │
└────────────────────────────────┘
```

---

## 七、开发优先级

### Phase 1: 核心 UI 优化

| 任务 | 优先级 | 说明 |
|------|--------|------|
| 首页左侧图标栏 | P0 | Seko 2.0 风格 |
| 顶部视图切换 | P0 | 画布/草稿/时间轴 |
| 画布侧边栏精简 | P0 | 48px 图标栏 |
| 分镜详情增强 | P0 | 上传图片 + 从草稿应用 |
| 画布拖拽到对话 | P0 | 图片拖到右侧面板 |

### Phase 2: 草稿视图实现

| 任务 | 优先级 | 说明 |
|------|--------|------|
| 草稿视图基础 | P1 | 节点画布 |
| 节点连接线 | P1 | 参考 Tapnow/test/copy-of-canvas |
| 草稿应用到分镜 | P1 | 选择器 + 更新逻辑 |

### Phase 3: 斜杠命令

| 任务 | 优先级 | 说明 |
|------|--------|------|
| `/gemini-all` 等四个命令 | P1 | 封装现有 API |
| 命令提示列表 | P1 | 输入 / 后弹出 |
| 批量编辑命令 | P2 | `/edit` `/add` `/delete` |

### Phase 4: 后续扩展

| 任务 | 优先级 |
|------|--------|
| 时间轴视频剪辑增强 | P3 |
| Pro 多 Track | P4 |

---

## 八、数据结构

### 8.1 草稿节点

存在 `projects.metadata.draftNodes`：

```json
{
  "draftNodes": [
    {
      "id": "xxx",
      "nodeType": "render",
      "imageUrl": "...",
      "parentId": "yyy",
      "position": { "x": 100, "y": 200 },
      "model": "gemini",
      "createdAt": 1234567890
    }
  ]
}
```

### 8.2 分镜表扩展

```sql
ALTER TABLE public.shots
  ADD COLUMN IF NOT EXISTS uploaded_images JSONB DEFAULT '[]'::jsonb;
```

---

## 九、总结

| 维度 | 之前方案 | 优化后 |
|------|----------|--------|
| **草稿入口** | 右侧面板 Tab | 顶部视图切换 |
| **视图数量** | 2个（画布/时间轴）| 3个（画布/草稿/时间轴） |
| **右侧面板** | Agent/Pro/草稿 | Agent/Pro（草稿移走） |
| **草稿能力** | 模糊 | 只处理图片 |
| **视频处理** | 模糊 | 只在时间轴 |

这样更清晰：
- **画布** = 结构化分镜图片管理
- **草稿** = 自由图片探索（无限画布）
- **时间轴** = 视频生成和剪辑
