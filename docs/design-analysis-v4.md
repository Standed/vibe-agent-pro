# Video Agent Pro 深度分析与设计优化 v4

> **基于**：用户批注 + Seko 2.0 截图 + test/copy-of-canvas 代码 + 现有项目代码  
> **日期**：2026-01-01

---

## 一、用户批注深度回应

### 1.1 进入画布无需确认弹窗

**用户原话**：
> "进入画布是不是不需要弹窗会更好，因为有些是用户需要准备资产的，有些就是纯粹一个分镜一个分镜那样慢慢手动建立的"

**分析**：
- 确认弹窗是假设用户必须"准备好资产再进画布"
- 实际上：
  - **抽象片/实验片**：不需要角色资产，直接生成
  - **手动创作**：一个分镜一个分镜慢慢建立
  - **资产补充**：随时可以从画布左侧侧边栏编辑

**结论**：
- ❌ 删除进入画布的确认弹窗
- ✅ 策划页保留"进入画布"按钮，但不做强制检查
- ✅ 画布左侧始终提供资产编辑入口

---

### 1.2 首页采用 Seko 2.0 风格

**Seko 2.0 截图分析**：
- 左侧 ~48px 图标栏（Logo、灵感广场、素材库等）
- 中央大背景 + 灵感输入框
- 下方项目瀑布流

**适配我们的首页**：

```
┌────┬──────────────────────────────────────────────────────────────┐
│    │                                                              │
│ 🏠 │                  ┌────────────────────────────┐              │
│ 📁 │                  │ ✨ 有什么新的故事灵感？     │              │
│ 🎨 │                  └────────────────────────────┘              │
│    │                                                              │
│ ── │  灵感广场（推荐模板）                                        │
│ ⚙️ │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐         │
│    │  │ 模板1   │  │ 模板2   │  │ 模板3   │  │ 模板4   │         │
│    │  └─────────┘  └─────────┘  └─────────┘  └─────────┘         │
│    │                                                              │
│    │  最近项目                                                    │
│    │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐         │
│    │  │ 项目1   │  │ 项目2   │  │ 项目3   │  │ + 新建  │         │
│    │  └─────────┘  └─────────┘  └─────────┘  └─────────┘         │
│    │                                                              │
└────┴──────────────────────────────────────────────────────────────┘
 48px                      主区域
```

**左侧图标栏功能**：
| 图标 | 功能 | 对应现有/新增 |
|------|------|--------------|
| 🏠 | 首页/项目列表 | 现有 page.tsx |
| 📁 | 素材库 (全局资产) | 新增：公共角色/场景/图片 |
| 🎨 | 草稿画布 (连续创作) | 新增：类似 test/copy-of-canvas |
| ⚙️ | 设置 | 现有 |

---

### 1.3 草稿模式优先级与入口

**用户批注**：
> "草稿模式优先级是不是要提高，跟核心链路比较相关"
> "是单独的草稿模式，还是在该项目能切换的模式，还是针对项目中分镜能进入的模式"

**深度分析**：

| 方案 | 优点 | 缺点 |
|------|------|------|
| **独立页面** | 完全自由探索，不干扰项目 | 结果难以应用到项目 |
| **项目内切换** | 探索结果直接关联项目 | 切换心智负担 |
| **分镜级进入** | 最小粒度，精确探索 | 需要先有分镜结构 |

**建议方案**：**项目内切换 + 首页独立入口**

```
首页左侧图标 [🎨 草稿]
     ↓
独立草稿画布（不关联项目，自由探索）
     ↓
生成结果 → [应用到项目] 按钮
           ↓
       选择目标项目和分镜
```

**同时**：
```
项目画布页 → 右上角 [切换草稿模式]
     ↓
项目关联草稿画布（探索结果可直接应用到当前项目分镜）
```

**从 test/copy-of-canvas 借鉴**：
- `NodeType: 'prompt' | 'asset_group' | 'render' | 'slice'`
- `parentId` 关联父节点
- `position` 支持自由布局
- 不限制纵向链条，支持自由连接

---

### 1.4 斜杠命令基于实际功能

**用户批注**：
> "优先是把我这四个集成好，比如Gemini直出生成所有分镜、Gemini Grid 2x2生成所有分镜、Sora2生成所有分镜视频、使用即梦生成所有分镜"

**现有 ChatPanel 支持的模型**：
- `gemini-grid` (2x2 网格)
- `jimeng` (即梦)
- `gemini-single` (单图)
- Sora 通过 `sora_tasks` 表异步处理

**Agent 模式命令（基于实际功能）**：

```
# 批量生成核心命令
/gemini-all          使用 Gemini 直出生成所有待生成分镜
/grid-all            使用 Gemini Grid 2x2 生成所有待生成分镜
/jimeng-all          使用即梦生成所有待生成分镜
/sora-all            使用 Sora 2 生成所有待生成分镜视频

# 场景级命令
/gemini 场景1        生成场景1的所有分镜（Gemini 直出）
/grid 场景1          生成场景1的所有分镜（Gemini Grid）
/jimeng 场景1        生成场景1的所有分镜（即梦）
/sora 场景1          生成场景1的所有分镜视频（Sora）

# 辅助命令
/storyboard          从剧本生成分镜脚本
/status              查看当前生成状态
```

**Pro 模式命令（基于现有按钮）**：

现有 ChatPanel 已有的交互按钮：
- 应用图片到分镜
- 重新生成
- 切片选择（Grid）
- 预览大图

因此 Pro 模式命令更多是**快捷触发**：
```
/apply               应用当前选中图片
/regenerate          重新生成当前分镜
/slice [1-4]         选择 Grid 切片
/preview             预览大图
/switch-model        切换生成模型
```

---

### 1.5 Agent 能力边界

**用户批注**：
> "要做到能够批量编辑分镜内的各种元素（增删改查）、以及批量指定分镜生成等等，也要支持场景级别的指令和项目级别的指令"

**三级指令范围**：

| 级别 | 示例指令 | 影响范围 |
|------|----------|----------|
| **项目级** | "把所有分镜的景别改成中景" | 所有场景的所有分镜 |
| **场景级** | "生成场景1的所有分镜" | 指定场景的所有分镜 |
| **分镜级** | "把第3个镜头改成近景" | 单个分镜 |

**批量编辑能力**：
```
# 批量修改
"把场景1的所有分镜时长改成3秒"
"删除场景2的第3-5个分镜"
"在场景1的第2个分镜后插入3个新分镜"

# 批量生成
"重新生成场景1所有状态为待生成的分镜"
"用即梦生成所有角色是小明的分镜"
```

---

## 二、优化后的页面布局

### 2.1 首页（Seko 2.0 风格）

```
┌────┬──────────────────────────────────────────────────────────────┐
│    │                                                              │
│ 🏠 │                  ┌────────────────────────────┐              │
│ 📁 │                  │ ✨ 有什么新的故事灵感？     │              │
│ 🎨 │                  │ [角色][画风][剧本] [开始创作]│              │
│    │                  └────────────────────────────┘              │
│ ── │                                                              │
│ ⚙️ │  灵感广场                                        [查看更多]  │
│    │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐         │
│    │  │ 创作者  │  │ 模板    │  │ 案例    │  │ 教程    │         │
│    │  └─────────┘  └─────────┘  └─────────┘  └─────────┘         │
│    │                                                              │
│    │  最近项目                                                    │
│    │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐         │
│    │  │ 封面    │  │ 封面    │  │ 封面    │  │ + 新建  │         │
│    │  │ 项目名  │  │ 项目名  │  │ 项目名  │  │         │         │
│    │  └─────────┘  └─────────┘  └─────────┘  └─────────┘         │
│    │                                                              │
└────┴──────────────────────────────────────────────────────────────┘
```

### 2.2 策划页（怎么结合我们现有的AI自动分镜逻辑）

保持左右分栏，移除"进入画布确认逻辑"：

```
┌──────────────────────────────────┬───────────────────────────────┐
│ 左：资产与脚本区                 │ 右：Agent 对话区              │
│                                  │                               │
│ 📝 剧本 (可选)                   │ 对话记录                      │
│ 👤 角色 (可选)                   │                               │
│ 🏠 场景 (可选)                   │                               │
│ 🎬 分镜脚本 (至少1个)            │                               │
│                                  │                               │
│ [进入画布] ← 无需弹窗确认         │                               │
└──────────────────────────────────┴───────────────────────────────┘
```

### 2.3 画布页（Tapnow 美感）

```
┌────┬─────────────────────────────────────────────┬───────────────┐
│    │                                             │               │
│ 📋 │  主画布区域                                 │ [Agent] [Pro] │
│ 🎬 │                                             │               │
│ 📁 │  场景 + 分镜缩略图网格                      │  对话区域     │
│    │  (Tapnow 风格的卡片布局)                    │               │
│ ── │                                             │  支持拖入图片 │
│ 🎨 │  点击分镜 → 进入 Pro 模式                   │               │
│ ⚙️ │                                             │               │
│    │                                             │               │
└────┴─────────────────────────────────────────────┴───────────────┘
 48px              可伸缩                           320px
```

**左侧图标栏新增**：
- 🎨 草稿模式切换

---

## 三、开发优先级调整

### Phase 1: MVP（基于现有功能封装）

| 任务 | 说明 | 复用 |
|------|------|------|
| **首页左侧图标栏** | Seko 2.0 风格导航 | 新增 |
| **斜杠命令封装** | `/gemini-all` `/grid-all` `/jimeng-all` `/sora-all` | ChatPanel 现有逻辑 |
| **画布侧边栏精简** | 48px 图标栏 + 200px 内容区 | LeftSidebarNew |
| **画布拖拽到对话** | 分镜图片拖到 ChatPanel | 新增 |

### Phase 2: 核心体验

| 任务 | 说明 |
|------|------|
| **草稿模式** | 首页入口 + 画布内切换（优先级提高！） |
| **Agent 批量编辑** | 场景级/项目级指令支持 |
| **画布美化** | Tapnow 风格卡片布局 |

### Phase 3: 能力扩展

| 任务 | 说明 |
|------|------|
| Pro 多 Track | 暂不急 |
| 一键拉片 | 后续扩展 |
| 公共工作流 | 后续扩展 |

---

## 四、草稿模式详细设计

### 4.1 数据结构（借鉴 test/copy-of-canvas，可以再详细想想设计，结合tapnow那种）

```typescript
type NodeType = 'prompt' | 'asset_group' | 'render' | 'slice';

interface DraftNode {
  id: string;
  nodeType: NodeType;
  
  // 内容
  prompt?: string;           // prompt 节点
  imageUrl?: string;         // render 节点
  slices?: string[];         // slice 节点
  assetIds?: string[];       // asset_group 节点
  
  // 关系
  parentId?: string;         // 父节点
  
  // 布局（不限制方向）
  position: { x: number; y: number };
  
  // 元数据
  timestamp: number;
  model?: 'gemini' | 'jimeng' | 'sora';
}
```

### 4.2 入口与交互

**入口1：首页左侧 [🎨 草稿]**
→ 独立草稿画布
→ 不关联项目
→ 生成结果可"应用到项目"

**入口2：画布页右上角 [草稿模式]**
→ 项目关联草稿画布
→ 生成结果直接应用到当前项目分镜

### 4.3 与主画布的打通

```
草稿节点 [render]
    ↓ 点击"应用到分镜"
弹出目标选择器
    ↓ 选择 场景 → 分镜
更新 shots.grid_images 或 shots.primaryImageUrl
```

---

## 五、总结

| 问题 | 原方案 | 优化后 |
|------|--------|--------|
| 进入画布 | 需要确认弹窗 | ❌ 无需确认 |
| 首页布局 | 传统顶部导航 | Seko 2.0 左侧图标栏 |
| 斜杠命令 | 抽象命令 | 基于实际功能：gemini/grid/jimeng/sora |
| 草稿模式 | Phase 2 | Phase 1（优先级提高） |
| Agent 能力 | 单一 | 项目/场景/分镜三级指令 |
