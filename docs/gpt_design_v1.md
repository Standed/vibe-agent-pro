# Vibe Agent Pro 设计方案（基于现有代码与竞品分析）

> **目的**：在不颠覆现有架构的前提下，重新梳理三大板块（策划 / 画布 / 时间轴）的体验与资产管理方案  
> **依据**：现有代码结构（`LeftSidebarNew` / `DirectorMode` / `InfiniteCanvas` / `ChatPanel`）、`supabase/schema.sql`、`docs/ChatGPT-history.md`、`docs/Video Agent Pro 方案设计.pdf`  
> **更新日期**：2025-12-31

---

## 0. 核心目标与设计原则

1. **对话为核心**：用户“像写代码一样”通过对话完成大部分操作  
2. **长视频友好**：结构化资产管理（角色 / 场景 / 分镜 / 生成历史）优先于自由玩法  
3. **学习成本低**：5 分钟内完成第一个分镜生成  
4. **Pro 精调 + Agent 批量**：双模式清晰分工  
5. **可扩展但不复杂**：MVP 只做必要结构，未来能力以模块补齐

---

## 1. 竞品启发与差异化定位

### 1.1 竞品启发（来自 PDF）

- **Mulan**：模板化工作流、复制/粘贴节点、提示词注入、强 Agent 任务总览  
- **OiiOii**：可选模板（剧情/音乐/快速视频）、批量分镜修改、全局角色库  
- **Tapnow**：无限画布 + 节点化工作流、拖拽节点进对话框、分镜策划模板  
- **Seko 2.0**：三视图（策划/故事板/剪辑）切换，小巧左侧导航，美术风格统一  
- **Medeo**：聊天驱动 + todolist，批量分镜生成与编辑  
- **Flova**：故事板 + 时间线 + 右侧 AI 助手的典型布局  
- **纳米AI**：分镜编辑时进入独立的无限画布  
- **Aipai**：Agent/标准模式双轨，批量生成与精调分离

### 1.2 我们的差异化与风险（坦诚）

**优势（更适合中长视频）：**
- 四级结构（Series → Project → Scene → Shot）更适合叙事长视频  
- chat_messages 支持项目/场景/分镜级对话分层  
- 角色一致性设计（Jimeng 三视图 + Sora 参考）更接近专业制作流

**风险：**
- 结构化带来学习成本，Tapnow 更直观  
- 画布当前是“可视化”，不是“自由创作核心”  
- 优势需要 UI 强引导，否则用户感知不到

**结论**：短视频/探索型用户更容易被 Tapnow 吸引；我们必须把“长视频的结构化优势”可视化，才能成立。

---

## 2. 核心链路（策划 → 画布 → 时间轴）

```
首页（灵感输入 / 项目管理）
  ↓ 新建项目
策划页（剧本/资产/分镜脚本 + Agent 对话）
  ↓ 确认进入画布
画布页（结构化分镜可视化 + Pro 精调）
  ↓
时间轴视图（暂不深挖，保留入口）
```

**关键决策：**
- 策划页独立页面（更清晰的创作心智）  
- 进入画布需要确认（保证资产准备度）  
- 时间轴保持入口但不深挖设计

---

## 3. 页面布局建议（不改核心架构）

### 3.1 首页（灵感入口 + 项目管理）

**目标**：快速新建项目 → 进入策划页  

**布局建议**：
- 顶部：品牌 + 用户入口 + 新建项目按钮  
- 主区：**灵感输入框（首要 CTA）** + “一键生成剧本/分镜脚本”  
- 下方：项目列表（最近 / 收藏 / 系列）  
- 右侧（可选）：模板卡片（故事短片 / 漫剧 / 短片精品）

**行为**：输入灵感 → 创建项目 → 直接进入策划页

---

### 3.2 策划页（独立页面，左右分栏）

```
┌──────────────────────────────┬──────────────────────────────┐
│ 左：资产与脚本区             │ 右：Agent 对话区             │
│ - 剧本编辑器                 │ - 多轮对话                   │
│ - 角色列表（可编辑）         │ - 批量命令建议 chips         │
│ - 场景列表（可展开）         │ - 生成记录/待办              │
│ - 分镜脚本预览 / 表格编辑器  │                              │
└──────────────────────────────┴──────────────────────────────┘
```

**现有代码可复用：**
- 剧本编辑：`DirectorMode`  
- 分镜脚本表格：`ShotTableEditor`  
- AI 分镜生成：`useAIStoryboard` + `StoryboardService`

**进入画布的确认逻辑（建议）**：
- 必选：已有剧本或至少 1 个场景 + 1 个镜头  
- 弹窗提示：确认后进入画布（可再返回策划）

---

### 3.3 画布页（结构化画布 + 右侧聊天）

```
┌────────┬──────────────────────────┬─────────────────────┐
│ 左栏   │ 中央画布（场景分区）      │ 右侧对话（Agent/Pro）│
│ 48px   │ Scene → Shot 缩略图       │ ChatPanel / Agent   │
└────────┴──────────────────────────┴─────────────────────┘
```

**现有结构**：`LeftSidebarNew` + `InfiniteCanvas` + `RightPanel`  
**保持**：场景分区、缩略图列表、点击镜头进入 Pro 模式  

**重点优化**：
1. **画布内图片拖拽到右侧对话**  
   - ChatPanel 已支持拖拽文件（`handleDrop`）  
   - 建议补充：从画布拖拽图片 URL（`text/uri-list` + `application/x-shot-id`）

2. **图片点击只做预览 + 应用按钮**  
   - 点击放大预览  
   - 明确“应用到当前分镜”的主按钮（非收藏）

3. **分镜详情入口保持现有逻辑**  
   - 目前是侧边栏/画布触发全屏编辑（`ShotEditor`）  
   - 不再强行设计弹窗，保持一致

---

### 3.4 时间轴视图（暂不深入）

现有 `TimelineView` 已接入入口，后续再设计多轨模型与剪辑能力。

---

## 4. 资产与对话管理（基于现有数据结构）

### 4.1 数据结构现状（真实代码/Schema）

- `projects`：基础信息 + `metadata.script` 保存剧本（目前无独立 script 字段）  
- `scenes`：场景列表 + `grid_history`  
- `shots`：镜头数据 + `generation_history` / `grid_images`  
- `characters`：角色资产 + `metadata.soraIdentity`  
- `chat_messages`：项目 / 场景 / 分镜三级聊天记录  

**结论**：剧本 & 分镜脚本已经有存储路径，只是剧本在 `metadata` 内。  

### 4.2 资产引用机制（需要强化）

**现有能力**：
- `@` 提及角色/场景  
- ChatPanel 支持拖拽文件  

**建议补强**：
- 画布图 → 右侧对话（拖拽 URL）  
- 右侧对话的图片结果 → “应用到镜头”按钮  
- 统一“引用资产”面板（角色 / 场景 / 图片）

---

## 5. 一致性双模式（资产级别区分）

**目标**：降低理解成本，让用户明确“用哪条管线生成”

### 模式 1：即梦三视图（图 → 视频）
- 用途：风格化、动漫、角色一致性  
- 流程：三视图 → 文生图 → 图生视频  
- 入口：角色面板 Tab（“三视图”）

### 模式 2：Sora 参考（视频优先）
- 逻辑优先级：**Sora码 > 参考视频 > 正面全身图**  
- 用户无素材：提供“生成参考图”按钮  
- 入口：角色面板 Tab（“Sora 参考”）

**交互要点**：
- 用户只需选择模式；具体优先级由系统处理  
- Agent 对话可直接指令：“用即梦/用 Sora 生成”

---

## 6. “自由无限画布”与“结构化画布”的折中方案

### 6.1 为什么不能直接全项目无限画布？
- 长视频镜头多，画布拥挤  
- 资产管理难以追溯  
- 性能与认知负担都高

### 6.2 折中方案：**草稿模式 / Draft Board（后续）**

**概念**：  
独立于主画布，用于“连续创作 + 头脑风暴”。  

**参考 test/copy-of-canvas 方案：**
- NodeType / parentId / position  
- 纵向链条 + 连接线  
- 生成结果一键“应用到分镜”

**定位**：  
草稿空间属于“灵感探索”，主画布仍然是结构化成果展示。

---

## 7. 左侧侧边栏优化（基于现有 LeftSidebarNew）

**现状**：  
宽度 320px + 三 Tab（策划/分镜/资源）+ 信息密度偏高

**短期可做（不改架构）**：
1. **宽度默认 260px**，保留可拖拽  
2. **场景默认折叠**，只展开当前场景  
3. **紧凑模式开关**：缩略图 + 简短文本  
4. **场景快速跳转**（下拉或搜索）

**Tapnow 风格借鉴**：
左侧增加 **48px 图标栏**，点击展开面板（视觉更轻）

---

## 8. 对话为核心（Agent / Pro 分工清晰）

| 模式 | 目标 | 场景 |
|------|------|------|
| **Agent** | 批量生成 / 批量修改 | 分镜脚本拆解、批量生成图/视频 |
| **Pro** | 精细调控 / 单镜头迭代 | 单镜头细化、局部优化 |

**Slash/Skill 系统**：  
不是 P0，但建议保留扩展点：  
- Agent：`/storyboard` `/batch` `/auto-fix`  
- Pro：`/generate` `/refine` `/video`  

---

## 9. 未来核心场景（先留钩子，不细化）

- **一键拉片**（脚本 → 分镜脚本 → 图）  
- **情绪版 / Moodboard**（统一风格、色彩、情绪参考）  
- **姿势控制 / 关键帧控制**（用于一致性强化）  
- **公共工作流**（ComfyUI / RunningHub 模板化入口）  
- **公共资产库**（团队复用）

---

## 10. 待确认问题

1. 画布内“拖拽图片到对话框”是否需要视觉落点提示？  
2. 策划页“进入画布”确认弹窗需要包含哪些检查项？  
3. 草稿模式未来是独立入口还是画布内切换？  
4. 首页是否需要“模板/一键拉片”卡片作为新手引导？
