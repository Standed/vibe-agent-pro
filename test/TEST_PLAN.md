# Vibe Agent Pro - 测试计划

## 测试目标
验证核心功能的完整性和稳定性，确保：
1. 分镜脚本拆解功能正常
2. 角色/场景资源系统完整
3. 参考图集成功能有效
4. 图片生成流程稳定

---

## 测试环境
- **浏览器**: Chrome/Safari/Firefox 最新版本
- **开发服务器**: http://localhost:3000
- **测试项目**: 创建专门的测试项目

---

## 功能测试清单

### 1. 分镜脚本显示修复 ✅
**测试目的**: 验证修复后的分镜脚本显示逻辑

**测试步骤**:
1. 打开项目 http://localhost:3000/project/project_1764746845663
2. 检查左侧边栏"分镜脚本"标签页
3. 验证镜头数量显示是否正确
4. 展开/折叠场景，检查镜头列表是否正常显示

**预期结果**:
- [ ] 分镜脚本显示正确的镜头数量（不是 0）
- [ ] 每个场景下的镜头能正常显示
- [ ] 镜头点击选择功能正常

**测试数据**: 使用现有项目数据

---

### 2. 角色三视图生成 🆕
**测试目的**: 验证角色三视图 AI 自动生成功能

**测试步骤**:
1. 点击左侧边栏"资源"标签
2. 点击"添加角色"
3. 输入角色信息：
   - 名称：测试角色A
   - 描述：30岁左右的男性，戴眼镜
   - 外貌：短发，中等身材
4. 点击"AI 生成三视图"按钮
5. 等待生成完成
6. 验证生成的图片

**预期结果**:
- [ ] 生成按钮可点击（输入名称后）
- [ ] 生成过程显示加载状态
- [ ] 生成图片为 21:9 横屏比例
- [ ] 图片包含：面部特写 + 三视图（正面、侧面、背面）
- [ ] 图片添加到参考图列表
- [ ] 可以重新生成（多次点击）
- [ ] 可以删除生成的图片

**测试数据**:
```
名称: 李明
描述: 35岁程序员，性格内向，经常熬夜工作
外貌: 短发，戴黑框眼镜，中等身材，常穿格子衬衫
```

---

### 3. AI 分镜脚本拆解 + 角色识别 🆕
**测试目的**: 验证 AI 能正确拆解剧本并识别角色

**测试步骤**:
1. 创建新项目
2. 在"剧本"标签页输入测试剧本：
   ```
   室内 - 咖啡厅 - 白天

   李明坐在靠窗的位置，盯着笔记本电脑屏幕。他的眼睛布满血丝，显然一夜没睡。

   王医生推门而入，环顾四周，看到李明后走过去。

   王医生：李明，你昨晚又通宵了？

   李明抬起头，勉强挤出一个笑容。

   李明：有个 bug 一直没找到，就......

   王医生坐下，关切地看着他。

   王医生：你这样下去身体会垮的。来，先喝杯咖啡。
   ```
3. 点击"AI 自动分镜"按钮
4. 等待生成完成
5. 检查生成的分镜

**预期结果**:
- [ ] 成功拆解为多个场景和镜头
- [ ] 每个镜头有 `mainCharacters` 字段（包含 "李明"、"王医生"）
- [ ] 每个镜头有 `mainScenes` 字段（包含 "咖啡厅"）
- [ ] 对话正确提取到 `dialogue` 字段
- [ ] 镜头描述包含场景、人物、动作、情绪等要素
- [ ] 镜头时长分配合理（2-4秒）

**验证方式**: 在浏览器控制台查看 shot 对象的 `mainCharacters` 和 `mainScenes` 字段

---

### 4. 参考图标记系统 🆕
**测试目的**: 验证提示词中包含正确的参考图标记

**前置条件**: 先创建角色资源并上传/生成参考图

**测试步骤**:
1. 在"资源"标签页创建角色：
   - 名称：苏白
   - 描述：25岁女性，活泼开朗
   - 上传或生成参考图（至少1张）
2. 创建场景地点：
   - 名称：现代办公室
   - 类型：室内
   - 上传参考图（至少1张）
3. 在分镜中添加包含这些角色/场景的镜头
4. 生成图片时，在浏览器控制台查看提示词

**预期结果**:
- [ ] 提示词包含【角色信息】部分
- [ ] 提示词包含【场景信息】部分
- [ ] 提示词包含【参考图像】部分
- [ ] 参考图标记格式正确：`(第一个参考图)`, `(第二个参考图)` 等
- [ ] 每个参考图都有对应的说明（角色/场景名称）

**验证方式**:
```javascript
// 在浏览器控制台执行
console.log('测试提示词富化功能')
```

---

### 5. Gemini Grid 生成 + 参考图传递 🆕
**测试目的**: 验证 Gemini Grid 模式能正确传递参考图

**前置条件**:
- 已配置 Gemini API Key
- 已创建角色并上传参考图

**测试步骤**:
1. 选择包含角色的镜头
2. 在右侧 Pro 面板选择"Grid 生成"
3. 输入提示词，包含角色名称（如"苏白在办公室工作"）
4. 选择 2x2 Grid
5. 点击生成
6. 在浏览器网络面板查看 API 请求

**预期结果**:
- [ ] API 请求包含 `parts` 数组
- [ ] `parts` 包含多个 `inlineData` 对象（参考图）
- [ ] 参考图以 base64 格式传递
- [ ] 生成的图片反映了参考图的风格/特征
- [ ] Grid 成功切片为 4 个独立图片

**验证方式**: 打开浏览器 DevTools -> Network -> 查找 `generateContent` 请求

---

### 6. 批量生成 + 参考图集成 🆕
**测试目的**: 验证批量生成时参考图正确传递

**测试步骤**:
1. 选择一个场景（包含多个镜头）
2. 点击"批量生成场景"
3. 选择 Grid 模式
4. 等待生成完成
5. 检查生成结果

**预期结果**:
- [ ] 每个镜头都成功生成图片
- [ ] 包含角色的镜头使用了对应的参考图
- [ ] 生成过程显示进度
- [ ] 错误处理正常（如果某个镜头失败）
- [ ] 生成历史记录正确保存

---

### 7. 侧边栏镜头列表（无拖拽）✅
**测试目的**: 验证移除拖拽功能后的侧边栏正常工作

**测试步骤**:
1. 打开项目
2. 在左侧边栏"分镜脚本"中查看镜头列表
3. 尝试点击镜头
4. 尝试删除镜头
5. 确认无法拖拽镜头

**预期结果**:
- [ ] 镜头点击选择功能正常
- [ ] 删除镜头功能正常
- [ ] 镜头列表显示正确（缩略图、编号、描述）
- [ ] **无法拖拽镜头重新排序**（功能已移除）
- [ ] 不再出现"0 个分镜"的 bug

---

## 性能测试

### 8. 大量镜头加载
**测试步骤**:
1. 生成包含 20+ 镜头的项目
2. 打开项目
3. 观察加载速度和 UI 响应

**预期结果**:
- [ ] 页面加载时间 < 3秒
- [ ] 镜头列表滚动流畅
- [ ] 内存使用合理（< 500MB）

---

## 错误处理测试

### 9. API 错误处理
**测试场景**:
- Gemini API Key 无效
- 网络断开
- API 限额超出

**预期结果**:
- [ ] 显示友好的错误提示
- [ ] 不会导致页面崩溃
- [ ] 错误信息包含可操作的建议

---

## 浏览器兼容性测试

### 10. 多浏览器测试
**测试浏览器**:
- [ ] Chrome (最新版)
- [ ] Safari (最新版)
- [ ] Firefox (最新版)
- [ ] Edge (最新版)

**测试内容**: 核心功能在所有浏览器中正常工作

---

## 测试结果记录

### 测试执行日期: ___________

### 通过的测试: __ / 10

### 发现的问题:

1. **问题描述**:
   - 重现步骤:
   - 影响程度:
   - 修复状态:

2. **问题描述**:
   - 重现步骤:
   - 影响程度:
   - 修复状态:

---

## 测试总结

**整体评估**:

**建议改进**:

**可以发布**: [ ] 是 [ ] 否

---

## 附录：测试数据

### 测试剧本 1（简单）
```
室内 - 客厅 - 晚上

小明坐在沙发上看电视。

电话响了。

小明拿起电话。

小明：喂？
```

### 测试剧本 2（复杂）
```
室外 - 公园 - 清晨

阳光透过树叶洒下斑驳的光影。

苏白慢跑经过，戴着耳机，脸上带着微笑。

突然，她停下脚步，看向长椅。

长椅上，李明正在埋头写代码，笔记本电脑放在腿上。

苏白走过去。

苏白：李明？你怎么在这里？

李明抬起头，惊讶地看着她。

李明：苏白！我......我在找灵感。

苏白笑了。

苏白：在公园写代码找灵感？这创意不错。

两人相视而笑。
```

### 测试角色数据
```
角色1:
名称: 李明
描述: 35岁程序员，技术专家，工作狂，但内心柔软
外貌: 短发，戴黑框眼镜，中等身材，常穿格子衬衫和牛仔裤

角色2:
名称: 苏白
描述: 28岁产品经理，活泼开朗，喜欢运动，善于沟通
外貌: 长发扎马尾，大眼睛，身材修长，喜欢运动装

角色3:
名称: 王医生
描述: 45岁家庭医生，温和耐心，关心他人健康
外貌: 头发花白，戴金丝眼镜，穿白大褂
```

### 测试场景数据
```
场景1:
名称: 现代办公室
类型: 室内
描述: 开放式办公空间，落地窗，白色墙面，木质办公桌

场景2:
名称: 咖啡厅
类型: 室内
描述: 温馨小资，原木家具，暖黄灯光，窗外街景

场景3:
名称: 城市公园
类型: 室外
描述: 绿树成荫，有慢跑道，长椅，清晨阳光
```
